{
  "data": {
    "meta": {
      "adoptsFrom": {
        "name": "Skill",
        "module": "https://cardstack.com/base/skill"
      }
    },
    "type": "card",
    "attributes": {
      "title": "Core Patterns",
      "cardInfo": {
        "notes": null,
        "title": null,
        "description": null,
        "thumbnailURL": null
      },
      "commands": [],
      "description": "Essential code patterns for CardDef, FieldDef, computed properties, and templates",
      "instructions": "**Card with computed title:**\n```gts\nexport class BlogPost extends CardDef {\n  @field headline = contains(StringField);\n  \n  @field title = contains(StringField, {\n    computeVia: function(this: BlogPost) {\n      return this.headline ?? 'Untitled Post';\n    }\n  });\n}\n```\n\n**Field definition:**\n```gts\nexport class AddressField extends FieldDef {\n  @field street = contains(StringField);\n  @field city = contains(StringField);\n  \n  static embedded = class Embedded extends Component<typeof this> {\n    <template>\n      <div class=\"address\">\n        <@fields.street /> <@fields.city />\n      </div>\n    </template>\n  };\n}\n```\n\n<!--more-->\n\n## Core Patterns\n\n### 1. Card Definition with Safe Computed Title\n```gts\n// ═══ [EDIT TRACKING: ON] Mark all changes with ⁿ ═══\nimport { CardDef, field, contains, linksTo, containsMany, linksToMany, Component } from 'https://cardstack.com/base/card-api'; // ⁸ Core imports\nimport StringField from 'https://cardstack.com/base/string';\nimport DateField from 'https://cardstack.com/base/date';\nimport FileTextIcon from '@cardstack/boxel-icons/file-text'; // ⁹ icon import\nimport { Author } from './author';\n\nexport class BlogPost extends CardDef { // ¹⁰ Card definition\n  static displayName = 'Blog Post';\n  static icon = FileTextIcon;  // ✅ CORRECT: Boxel icons for static card/field type icons\n  static prefersWideFormat = true; // Optional: Only for dashboards/apps. Content cards (albums, listings) rarely need this.\n  \n  @field headline = contains(StringField); // ¹¹ Primary identifier - NOT 'title'!\n  @field publishDate = contains(DateField);\n  @field author = linksTo(Author);        // ¹² Reference to another card\n  @field tags = containsMany(TagField);   // ¹³ Multiple embedded fields\n  @field relatedPosts = linksToMany(() => BlogPost); // ¹⁴ Self-reference with arrow function\n  \n  // ¹⁵ Compute the inherited title from primary fields ONLY - keep it simple!\n  @field title = contains(StringField, {\n    computeVia: function(this: BlogPost) {\n      try {\n        const baseTitle = this.headline ?? 'Untitled Post';\n        const maxLength = 50;\n        \n        if (baseTitle.length <= maxLength) return baseTitle;\n        return baseTitle.substring(0, maxLength - 3) + '...';\n      } catch (e) {\n        console.error('BlogPost: Error computing title', e);\n        return 'Untitled Post';\n      }\n    }\n  });\n}\n```\n\n### WARNING: Do NOT Use Constructors for Default Values\n\n**CRITICAL:** Constructors should NOT be used for setting default values in Boxel cards. Use template fallbacks (if field is editable) or computeVia (only if field is strictly read-only) instead.\n\n```gts\n// ❌ WRONG - Never use constructors for defaults\n// ═══ [EDIT TRACKING: ON] Mark all changes with ⁿ ═══\nexport class Todo extends CardDef {\n  constructor(owner: unknown, args: {}) {\n    super(owner, args);\n    this.createdDate = new Date(); // DON'T DO THIS\n    this.isCompleted = false;      // DON'T DO THIS\n  }\n}\n```\n\n### **CRITICAL: NEVER Create JavaScript Objects in Templates**\n\n**Templates are for simple display logic only.** Never call constructors, create objects, or perform complex operations in template expressions.\n\n```hbs\n<!-- ❌ WRONG: Creating objects in templates -->\n<span>{{if @model.currentMonth @model.currentMonth (formatDateTime (new Date()) \"MMMM YYYY\")}}</span>\n<div>{{someFunction(@model.data)}}</div>\n\n<!-- ✅ CORRECT: Move logic to JavaScript computed properties -->\n<span>{{if @model.currentMonth @model.currentMonth this.currentMonthDisplay}}</span>\n<div>{{this.processedData}}</div>\n```\n\n```gts\n// ✅ CORRECT: Define logic in JavaScript\nexport class MyCard extends CardDef { // ²⁴ Card definition\n  get currentMonthDisplay() {\n    return new Intl.DateTimeFormat('en-US', { \n      month: 'long', \n      year: 'numeric' \n    }).format(new Date());\n  }\n  \n  get processedData() {\n    return this.args.model?.data ? this.processData(this.args.model.data) : 'No data';\n  }\n  \n  private processData(data: any) {\n    // Complex processing logic here\n    return result;\n  }\n}\n```\n\n### 2. Field Definition (Always Include Embedded Template)\n\n**CRITICAL:** Every FieldDef file must import FieldDef and MUST be exported:\n\n```gts\n// ═══ [EDIT TRACKING: ON] Mark all changes with ⁿ ═══\nimport { FieldDef, field, contains, Component } from 'https://cardstack.com/base/card-api'; // ¹⁶ Core imports\nimport StringField from 'https://cardstack.com/base/string';\nimport LocationIcon from '@cardstack/boxel-icons/map-pin'; // ¹⁷ icon import\n\n// Creating a new field from scratch\nexport class AddressField extends FieldDef { // ¹⁸ Field definition\n  static displayName = 'Address';\n  static icon = LocationIcon; // ✅ CORRECT: Boxel icons for static card/field type icons\n  \n  @field street = contains(StringField); // ¹⁹ Component fields\n  @field city = contains(StringField);\n  @field postalCode = contains(StringField);\n  @field country = contains(StringField);\n  \n  // ²⁰ Always create embedded template for FieldDefs\n  static embedded = class Embedded extends Component<typeof this> {\n    <template>\n      <div class=\"address\">\n        {{#if @model.street}}\n          <div><@fields.street /></div>\n        {{else}}\n          <div class=\"placeholder\">Street address not provided</div>\n        {{/if}}\n        \n        <div>\n          {{if @model.city @model.city \"City\"}}{{if @model.postalCode (concat \", \" @model.postalCode) \"\"}}\n        </div>\n        \n        {{#if @model.country}}\n          <div><@fields.country /></div>\n        {{else}}\n          <div class=\"placeholder\">Country not specified</div>\n        {{/if}}\n      </div>\n      \n      <style scoped> /* ²¹ Component styles */\n        /* Minimal styling for placeholders */\n        .placeholder {\n          font-style: italic;\n        }\n      </style>\n    </template>\n  };\n}\n\n// ✅ CORRECT: Extending a base field for customization\nimport BaseAddressField from 'https://cardstack.com/base/address';\n\nexport class EnhancedAddressField extends BaseAddressField { // ²⁵ Extended field\n  static displayName = 'Enhanced Address';\n  \n  // ²⁶ Add new fields to the base\n  @field apartment = contains(StringField);\n  @field instructions = contains(StringField);\n  \n  // ²⁷ Override templates as needed\n  static embedded = class Embedded extends Component<typeof this> {\n    <template>\n      <!-- Custom template that includes new fields -->\n    </template>\n  };\n}\n```\n\n### 3. Computed Properties with Safety\n\n**CRITICAL:** Avoid cycles and infinite recursion in computed fields.\n\n```gts\n// ❌ DANGEROUS: Self-reference causes infinite recursion\n@field title = contains(StringField, {\n  computeVia: function(this: BlogPost) {\n    return this.title || 'Untitled'; // ❌ Refers to itself - STACK OVERFLOW!\n  }\n});\n\n// ❌ DANGEROUS: Circular dependency between computed fields\n@field displayName = contains(StringField, {\n  computeVia: function(this: Person) {\n    return this.formattedName; // refers to formattedName\n  }\n});\n@field formattedName = contains(StringField, {\n  computeVia: function(this: Person) {\n    return `Name: ${this.displayName}`; // refers back to displayName - CYCLE!\n  }\n});\n\n// ✅ SAFE: Reference only base fields, keep it unidirectional\n@field fullName = contains(StringField, { // ²⁸ Computed field\n  computeVia: function(this: Person) {\n    try {\n      const first = this.firstName ?? '';\n      const last = this.lastName ?? '';\n      const full = `${first} ${last}`.trim();\n      return full || 'Name not provided';\n    } catch (e) {\n      console.error('Person: Error computing fullName', e);\n      return 'Name unavailable';\n    }\n  }\n});\n\n// ✅ SAFE: Computed title from primary fields only with error handling\n@field title = contains(StringField, { // ²⁹ Safe computed title\n  computeVia: function(this: BlogPost) {\n    try {\n      const headline = this.headline ?? 'Untitled Post';\n      const date = this.publishDate ? ` (${new Date(this.publishDate).getFullYear()})` : '';\n      return `${headline}${date}`;\n    } catch (e) {\n      console.error('BlogPost: Error computing title', { error: e, headline: this.headline });\n      return 'Untitled Post';\n    }\n  }\n});\n```\n\n### 4. Templates with Proper Computation Patterns\n\n**Remember:** When implementing templates via SEARCH/REPLACE, track all major sections with ⁿ and include the post-block notation `╰ ⁿ⁻ᵐ`\n\n```gts\nstatic isolated = class Isolated extends Component<typeof BlogPost> { // ³⁰ Isolated format\n  @tracked showComments = false;\n  \n  // ³¹ CRITICAL: Do ALL computation in functions, never in templates\n  get safeTitle() {\n    try {\n      return this.args?.model?.title ?? 'Untitled Post';\n    } catch (e) {\n      console.error('BlogPost: Error accessing title', e);\n      return 'Untitled Post';\n    }\n  }\n  \n  get commentButtonText() {\n    try {\n      const count = this.args?.model?.commentCount ?? 0;\n      return this.showComments ? `Hide Comments (${count})` : `Show Comments (${count})`;\n    } catch (e) {\n      console.error('BlogPost: Error computing comment button text', e);\n      return this.showComments ? 'Hide Comments' : 'Show Comments';\n    }\n  }\n  \n  // methods referenced from templates must be defined with fat arrow (=>) so that they are properly bound when invoked\n  toggleComments = () => {\n    this.showComments = !this.showComments;\n  }\n  \n  <template>\n    <!-- ³² Responsive surface that adapts from wide layouts down to mobile -->\n    <article class=\"blog-post-surface\">\n      <header>\n        <time>{{if @model.publishDate (formatDateTime @model.publishDate 'MMMM D, YYYY') \"Date not set\"}}</time>\n        <h1>{{this.safeTitle}}</h1>\n        \n        {{#if @fields.author}}\n          <@fields.author />\n        {{else}}\n          <div class=\"author-placeholder\">Author not specified</div>\n        {{/if}}\n      </header>\n      \n      <div class=\"post-content\">\n        {{#if @model.body}}\n          <@fields.body />\n        {{else}}\n          <div class=\"content-placeholder\">\n            <p>No content has been written yet. Click to start writing!</p>\n          </div>\n        {{/if}}\n      </div>\n      \n      <!-- ³³ Handle arrays with REQUIRED spacing -->\n      {{#if (gt @model.tags.length 0)}}\n        <section class=\"tags-section\">\n          <h4>Tags</h4>\n          <div class=\"tags-container\">\n            <@fields.tags @format=\"atom\" />\n          </div>\n        </section>\n      {{/if}}\n      \n      {{#if (gt @model.commentCount 0)}}\n        <Button \n          @variant=\"ghost\" \n          class=\"comment-button\"\n          {{on 'click' this.toggleComments}}\n        >\n          <svg class=\"button-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"/>\n          </svg>\n          {{this.commentButtonText}}\n        </Button>\n      {{/if}}\n      \n      {{#if this.showComments}}\n        <section class=\"comments-section\">\n          <h3>Discussion</h3>\n          {{#if (gt @model.comments.length 0)}}\n            <div class=\"comments-container\">\n              <@fields.comments @format=\"embedded\" />\n            </div>\n          {{else}}\n            <p class=\"no-comments\">No comments yet. Be the first to share your thoughts!</p>\n          {{/if}}\n        </section>\n      {{/if}}\n    </article>\n    \n    <style scoped> /* ³⁴ Component styles */\n      .blog-post-surface {\n        width: 100%;\n        max-width: 42rem;\n        margin: 0 auto;\n        padding: clamp(1.25rem, 4vw, 2rem);\n        display: flex;\n        flex-direction: column;\n        gap: clamp(1rem, 2.5vw, 1.5rem);\n        height: 100%;\n        min-height: 100%;\n        overflow-y: auto;\n        font-size: 0.875rem;\n        line-height: 1.3;\n      }\n      \n      @media (max-width: 800px) {\n        .blog-post-surface {\n          max-width: none;\n          padding: clamp(1rem, 6vw, 1.5rem);\n        }\n      }\n      \n      .blog-post-surface > header h1 {\n        font-size: clamp(1.125rem, 3vw, 1.5rem);\n        margin-top: 0.25rem;\n        line-height: 1.2;\n      }\n      \n      .post-content {\n        font-size: 0.8125rem;\n        line-height: 1.25;\n      }\n      \n      /* ³⁵ CRITICAL: Always style buttons completely - never use unstyled */\n      .comment-button {\n        /* Style Boxel components to match your design */\n        padding: 0.5rem 0.75rem;\n        font-size: 0.8125rem;\n        display: inline-flex;\n        align-items: center;\n        gap: 0.375rem;\n      }\n      \n      .comment-button .button-icon {\n        width: 1rem;\n        height: 1rem;\n      }\n      \n      /* ³⁶ CRITICAL: Spacing for containsMany collections */\n      .tags-container > .containsMany-field {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 0.25rem; /* Essential spacing between tags */\n      }\n      \n      .comments-container > .containsMany-field {\n        display: flex;\n        flex-direction: column;\n        gap: 0.75rem; /* Essential spacing between comments */\n      }\n    </style>\n  </template>\n};\n```"
    },
    "relationships": {
      "cardInfo.theme": {
        "links": {
          "self": null
        }
      }
    }
  }
}