{
  "data": {
    "meta": {
      "adoptsFrom": {
        "name": "SkillPlus",
        "module": "../skill-plus"
      }
    },
    "type": "card",
    "attributes": {
      "cardInfo": {
        "notes": null,
        "title": "Markdown Edit",
        "description": null,
        "thumbnailURL": null
      },
      "commands": [
        {
          "codeRef": {
            "name": "ApplyMarkdownEditCommand",
            "module": "../commands/apply-markdown-edit"
          },
          "requiresApproval": true
        }
      ],
      "instructions": "# Markdown Field Editing\n\n**SCOPE:** MarkdownField edits in card instances only. Use `patch-fields` for other fields, SEARCH/REPLACE for code.\n\n## When to Use\n- Large markdown where full replacement risks truncation\n- Surgical edits (headings, bullets, paragraphs) in lengthy docs\n- Sequential multi-step changes\n- **Deletions** where you need precise control\n\n## Core Concept: Focused Transformation\n\nThe command supports two modes:\n\n### Mode 1: Full Field (Legacy)\nSend only `markdownDiff` and let the model figure out where to apply it in the full document.\n\n### Mode 2: Focused Edit (Recommended)\nSend `currentContent` (the exact section you want to transform) plus `markdownDiff` (what it should become).\n\n**For deletions, Mode 2 is essential:**\n- `currentContent`: The full section INCLUDING what you want deleted\n- `markdownDiff`: Only the anchors that should remain (the deleted content is omitted)\n\n## Parameters\n\n| Param | Purpose |\n|-------|--------|\n| `cardId` | Full card URL |\n| `fieldPath` | e.g., `content`, `instructions` |\n| `currentContent` | **Optional but recommended**: The exact current text to transform |\n| `markdownDiff` | The replacement text (what remains after the edit) |\n| `instructions` | Brief intent (for logging/debugging) |\n\n## Patterns\n\n### Modify a Line\n```\ncurrentContent: \"### Quarterly Report\\n\"\nmarkdownDiff: \"### Quarterly Report (Final)\\n\"\ninstructions: \"Add (Final) suffix to heading\"\n```\n\n### Delete a Section (Key Pattern!)\n\n**Use the expanded-lasso approach:** Include content BEFORE and AFTER the deleted block in both `currentContent` and `markdownDiff`.\n\n```\nBEFORE:\n### 5.2 Evidence Evaluation\n...content...\n\n### 5.3 Critical Thinking\n...content to delete...\n\n### 5.4 Building Frameworks\n...content...\n\nTO DELETE 5.3:\ncurrentContent: \"### 5.2 Evidence Evaluation\\n...[end of 5.2 content]...\\n\\n### 5.3 Critical Thinking\\n...[full content of 5.3]...\\n\\n### 5.4 Building Frameworks\"\nmarkdownDiff: \"### 5.2 Evidence Evaluation\\n...[end of 5.2 content]...\\n\\n### 5.4 Building Frameworks\"\ninstructions: \"Delete section 5.3 entirely\"\n```\n\n**Why this works:**\n- The `currentContent` shows the full \"before\" state with anchors on both sides\n- The `markdownDiff` shows the \"after\" state (5.3 is simply absent)\n- The overlapping anchors (5.2 ending and 5.4 start) make it crystal clear what's being removed\n- No ambiguity about whitespace or neighboring content\n\n### Insert Content\n```\ncurrentContent: \"## Features\\n- Existing item\"\nmarkdownDiff: \"## Features\\n- New item\\n- Existing item\"\ninstructions: \"Add new item before existing\"\n```\n\n## Rules\n\n1. **Use `currentContent` for deletions** — it makes the before/after explicit\n2. **Expand the lasso** — include stable content before AND after the target\n3. **One logical change per call** — sequential, not parallel\n4. **Exact match required** — `currentContent` must match the document exactly\n5. **Diff = final state** — show what remains, not what's removed\n6. **Include anchors in both** — `markdownDiff` should have the same before/after anchors as `currentContent`\n\n**⚠️ CRITICAL: Execute edits sequentially, not in parallel.** Multiple command calls issued together are NOT guaranteed to run in order. For dependent revisions (e.g., delete then renumber), either:\n- Construct a **single edit** that accomplishes everything, OR\n- Execute **one edit at a time**, waiting for user approval between each\n\n## Error Recovery\n\n- \"currentContent not found\" → Check for exact match (whitespace, newlines matter)\n- Match failed? → Provide more context in `currentContent`\n- Overwrote neighbor? → Re-apply with exact text restoration"
    },
    "relationships": {
      "cardInfo.theme": {
        "links": {
          "self": "../Theme/cardstack"
        }
      }
    }
  }
}
