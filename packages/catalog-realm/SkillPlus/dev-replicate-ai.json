{
  "data": {
    "meta": {
      "adoptsFrom": {
        "name": "SkillPlus",
        "module": "../skill-plus"
      }
    },
    "type": "card",
    "attributes": {
      "cardInfo": {
        "notes": null,
        "title": "Replicate AI Integration",
        "description": "API patterns, enum fields, and response parsing for Replicate",
        "thumbnailURL": null
      },
      "commands": [],
      "instructions": "### Replicate API Essentials\n\n**Gateway URL Pattern:**\n```\nhttps://gateway.ai.cloudflare.com/v1/{account}/{gateway}/replicate/v1/models/{owner}/{model}/predictions\n```\n\n**Required Headers:**\n```typescript\n{\n  'Content-Type': 'application/json',\n  'Prefer': 'wait'  // CRITICAL: Synchronous response\n}\n```\n\n**Request Structure:**\n```typescript\n{\n  input: {\n    prompt: string,\n    // Model-specific parameters (see API docs)\n  }\n}\n```\n\n### Enum Fields for API Parameters\n\n**CRITICAL:** Enum `value` must exactly match API spec:\n\n```gts\nimport enumField from 'https://cardstack.com/base/enum';\n\nconst SizeField = enumField(StringField, {\n  options: [\n    { value: '1K', label: '1K (1024px)' },\n    { value: '2K', label: '2K (2048px)' },\n    { value: 'custom', label: 'Custom' }\n  ]\n});\n```\n\n### API Call Pattern\n\n```gts\nimport SendRequestViaProxyCommand from '@cardstack/boxel-host/commands/send-request-via-proxy';\nimport UploadImageCommand from 'https://realms-staging.stack.cards/catalog/commands/upload-image';\nimport GetCardCommand from '@cardstack/boxel-host/commands/get-card';\nimport { CloudflareImage } from 'https://realms-staging.stack.cards/catalog/cloudflare-image';\n\n// Build request\nconst requestBody = {\n  input: { prompt: input.prompt }\n};\n\n// Add conditional parameters\nif (input.size) requestBody.input.size = input.size;\nif (input.aspectRatio && input.size !== 'custom') {\n  requestBody.input.aspect_ratio = input.aspectRatio;\n}\n\n// Call API\nconst response = await new SendRequestViaProxyCommand(ctx).execute({\n  url: 'https://gateway.ai.cloudflare.com/v1/.../replicate/v1/models/{owner}/{model}/predictions',\n  method: 'POST',\n  requestBody: JSON.stringify(requestBody),\n  headers: { 'Content-Type': 'application/json', 'Prefer': 'wait' }\n});\n\n// Parse response\nconst data = await response.response.json();\nlet imageUrl = Array.isArray(data.output) ? data.output[0] : data.output;\n\n// Upload result\nconst uploaded = await new UploadImageCommand(ctx).execute({\n  sourceImageUrl: imageUrl,\n  targetRealmUrl: input.realm\n});\n\nreturn await new GetCardCommand(ctx).execute({ cardId: uploaded.cardId });\n```\n\n### Response Parsing\n\n```typescript\n// Handle multiple formats\nlet imageUrl: string | undefined;\n\nif (data.output && Array.isArray(data.output)) {\n  imageUrl = data.output[0];\n} else if (typeof data.output === 'string') {\n  imageUrl = data.output;\n} else if (data.output?.url) {\n  imageUrl = data.output.url;\n}\n\nif (!imageUrl) throw new Error('No image URL in response');\n```\n\n### Common Mistakes\n\n❌ Missing `Prefer: wait` header → async URL instead of result  \n❌ Enum value mismatch → API rejects request  \n❌ Always sending optional params → API validation errors  \n❌ String booleans in API → Use actual `true`/`false`\n\n### Finding Model Schemas\n\n1. Visit `https://replicate.com/{owner}/{model}`\n2. Check API tab for exact schema\n3. Note required vs optional parameters\n4. Match enum values exactly"
    },
    "relationships": {
      "cardInfo.theme": {
        "links": {
          "self": "../Theme/cardstack"
        }
      }
    }
  }
}